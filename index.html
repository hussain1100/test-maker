<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>مولّد كود Google Forms</title>
<style>
:root {
  --blue:#0b66d0;
  --lightblue:#e8f0fe;
  --bg:#f4f8fb;
  --muted:#5b6b80;
}
body{
  font-family:'Tahoma',sans-serif;
  background:var(--bg);
  color:#222;
  direction:rtl;
  margin:0;
  padding:20px;
}
.container{
  max-width:900px;
  margin:auto;
  background:#fff;
  border-radius:12px;
  padding:25px;
  box-shadow:0 8px 30px rgba(11,102,208,0.06);
}
h1{
  color:var(--blue);
  text-align:center;
  margin-bottom:5px;
}
label{display:block;margin-top:15px;font-weight:bold;}
textarea,input,select{
  width:100%;
  padding:10px;
  margin-top:5px;
  border:1px solid #c7d6e5;
  border-radius:8px;
  font-size:14px;
  box-sizing:border-box;
  background:#fff;
}
button{
  background:var(--blue);
  color:#fff;
  border:none;
  padding:12px 20px;
  border-radius:10px;
  cursor:pointer;
  margin-top:20px;
  font-size:16px;
}
button:hover{background:#095bb5;}
.note{
  background:var(--lightblue);
  border-radius:8px;
  padding:12px;
  margin-top:12px;
  white-space: pre-wrap;
}
</style>
</head>
<body>
<div class="container">
<h1>مولّد كود Google Forms</h1>
<p>اكتب الأسئلة والخيارات والإجابات الصحيحة، ثم اضغط زر "إنشاء الكود" للحصول على كود Google Apps Script جاهز للنسخ.</p>

<label>1) الأسئلة والخيارات (صيغة كل سؤال: رقم. نص السؤال ثم كل خيار سطر جديد يبدأ بالرمز أ/ب/ج/د):</label>
<textarea id="questions" rows="15" placeholder="مثال:
1. ما لون السماء؟
أ. أحمر
ب. أزرق
ج. أخضر
د. أصفر
"></textarea>

<label>2) الإجابات الصحيحة + الدرجة لكل سؤال (صيغة: رمز الإجابة مسافة الدرجة):</label>
<textarea id="answers" rows="10" placeholder="مثال:
ب 1
أ 2
"></textarea>

<label>3) الدرجة الموحدة لكل سؤال إذا لم يتم تحديد درجات فردية:</label>
<input type="number" id="singleGrade" value="1" min="0.5" step="0.5">

<button id="generateBtn">إنشاء الكود</button>

<label>4) معاينة الكود:</label>
<div class="note" id="preview">سيظهر الكود هنا بعد الضغط على الزر.</div>
</div>

<script>
// ---------- أدوات ----------
function trim(s){return (s||'').replace(/^\s+|\s+$/g,'');}
function parseQuestions(raw){
  const lines=(raw||'').split(/\r?\n/).map(l=>l.trim());
  const groups=[]; let cur=null;
  lines.forEach(line=>{
    if(!line) return;
    if(/^[\d]+\s*[\.\)]/.test(line)){
      if(cur) groups.push(cur);
      cur={question:line.replace(/^[\d]+\s*[\.\)]\s*/,'').trim(),options:[]};
      return;
    }
    let m=line.match(/^([أ-دA-D])\s*[\.\)]?\s*(.*)$/);
    if(m && cur){cur.options.push({label:m[1],text:m[2]}); return;}
    if(cur) cur.question+=' '+line;
  });
  if(cur) groups.push(cur);
  return groups;
}
function parseAnswers(raw){
  return (raw||'').split(/\r?\n/).map(l=>trim(l)).filter(Boolean);
}
function matchAnswers(questions,answers,singleGrade){
  const results=[];
  questions.forEach((q,i)=>{
    const ansRaw=answers[i]||'';
    const parts=ansRaw.split(/\s+/);
    const ch=parts[0]; const grade=parts[1]?parseFloat(parts[1]):singleGrade;
    results.push({correct:ch,points:grade});
  });
  return results;
}

// ---------- توليد كود Google Apps Script ----------
function generateGASCode(questions,answers,singleGrade){
  const matches=matchAnswers(questions,answers,singleGrade);
  let code="function createForm() {\n  var form = FormApp.create('اختبار مولّد');\n";
  questions.forEach((q,i)=>{
    const qText=q.question.replace(/'/g,"\\'");
    code+="  var item = form.addMultipleChoiceItem();\n";
    code+="  item.setTitle('"+qText+"')\n";
    code+="      .setChoices([\n";
    q.options.forEach((opt,j)=>{
      const correct=(opt.label===matches[i].correct)?'.setCorrectAnswer(true)':'';
      const optText=opt.text.replace(/'/g,"\\'");
      code+="        item.createChoice('"+optText+"')"+correct+",\n";
    });
    code+="      ]);\n";
    code+="  item.setPoints("+matches[i].points+");\n";
  });
  code+="  Logger.log('Form created: ' + form.getEditUrl());\n}";
  return code;
}

// ---------- زر ----------
document.getElementById('generateBtn').addEventListener('click',()=>{
  const qRaw=document.getElementById('questions').value;
  const aRaw=document.getElementById('answers').value;
  const singleGrade=parseFloat(document.getElementById('singleGrade').value)||1;
  const questions=parseQuestions(qRaw);
  const code=generateGASCode(questions,parseAnswers(aRaw),singleGrade);
  document.getElementById('preview').textContent=code;
});
</script>
</body>
</html>
