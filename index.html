<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>مُنشئ اختبار ذكي — Google Forms</title>
<style>
:root{--blue:#0b66ff;--midblue:#0b5ae6;--soft:#f3f8ff;--white:#ffffff}
body{margin:0;font-family:"Segoe UI",Tahoma,Geneva,Verdana,sans-serif;background:var(--soft);color:#0b2340}
.wrap{max-width:980px;margin:30px auto;padding:25px;background:var(--white);border-radius:16px;box-shadow:0 12px 35px rgba(11,38,64,0.1)}
header{display:flex;gap:16px;align-items:center;margin-bottom:20px}
.logo{width:64px;height:64px;border-radius:12px;background:linear-gradient(135deg,var(--blue),var(--midblue));display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;font-size:22px}
h1{margin:0;font-size:22px}
p.lead{margin:6px 0 18px;color:#234;font-size:15px}
.grid{display:grid;grid-template-columns:1fr 380px;gap:18px}
.card{background:linear-gradient(180deg,#fff,#fbfdff);padding:16px;border-radius:12px;border:1px solid rgba(11,102,255,0.08)}
label.small{display:block;font-size:13px;color:#0b2340;margin-bottom:6px}
textarea,input,select{width:100%;padding:10px;border-radius:8px;border:1px solid #d7e6ff;background:#fff;font-size:14px}
textarea{min-height:300px;resize:vertical}
.row{display:flex;gap:10px}
.btn{display:inline-block;padding:10px 16px;border-radius:10px;background:var(--blue);color:#fff;border:none;cursor:pointer}
.btn.secondary{background:transparent;color:var(--blue);border:1px solid rgba(11,102,255,0.15)}
.hint{font-size:13px;color:#445;text-align:right}
.output{white-space:pre-wrap;background:#0b102033;padding:10px;border-radius:8px;overflow:auto;font-family:monospace;font-size:13px;min-height:420px}
.small-muted{font-size:12px;color:#567}
footer{margin-top:16px;font-size:13px;color:#567;text-align:center}
@media(max-width:980px){.grid{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="wrap">
<header>
<div class="logo">Q</div>
<div>
<h1>مُنشئ اختبار ذكي — Google Forms</h1>
<p class="lead">ألصق اختبارك كما هو (بأي نمط). الأسئلة النصية يتم التعرف عليها تلقائياً بدون أي علامات. اضبط الدرجات وخيارات النتيجة، واضغط "إنشاء" لتحصل على كود Google Apps Script جاهز.</p>
</div>
</header>
<div class="grid">
<div class="card">
<label class="small">1) ألصق الأسئلة هنا:</label>
<textarea id="inputText" placeholder="مثال:\n1. الشخص الذي يعبد الله كأنه يراه …\nأ. المسلم\nب. المؤمن\nج. المحسن\nد. لا شيء مما ذكر\n\n2. ما هو مجموع 2 و2؟\nأ.3\nب.4\nج.5\n\nسؤال نصي: عرف الإيمان …"></textarea>
<div style="display:flex;gap:8px;margin-top:12px;align-items:center">
<div style="flex:1">
<label class="small">2) درجة موحدة لكل الأسئلة؟ (اترك 0 لاستخدام درجات فردية)</label>
<input id="uniformPoints" placeholder="مثلاً: 2" />
</div>
<div style="width:180px">
<label class="small">3) إظهار النتيجة فوراً بعد الاختبار؟</label>
<select id="showImmediately">
<option value="true">نعم</option>
<option value="false">لا</option>
</select>
</div>
</div>
<div style="display:flex;gap:8px;margin-top:12px;align-items:center">
<button class="btn" id="createBtn">إنشاء كود Google Forms</button>
<button class="btn secondary" id="clearBtn">مسح</button>
</div>
<div style="margin-top:12px">
<div class="small-muted">ملاحظات:</div>
<ul class="small-muted">
<li>الأسئلة النصية تُفهم تلقائياً إذا لم تُكتب خيارات أو تبدأ بصيغ: عرف، علل، أجب، عدد، ضع دائرة…</li>
<li>أسئلة الاختيار من متعدد يجب أن تكون مصحوبة بالخيارات أ., ب., ج., د. أو a., b., c., d.</li>
</ul>
</div>
</div>
<div class="card">
<label class="small">النتيجة: كود جاهز للنسخ</label>
<div id="result" class="output">اضغط "إنشاء" لتوليد الكود هنا...</div>
<div style="margin-top:10px;display:flex;gap:8px">
<button class="btn" id="copyBtn">نسخ إلى الحافظة</button>
<a id="downloadLink" style="text-decoration:none" class="btn secondary">تنزيل الملف</a>
</div>
<div style="margin-top:10px" class="hint">الصق الكود في <a href="https://script.google.com" target="_blank">Google Apps Script</a> لتوليد النموذج.</div>
</div>
</div>
<footer>التصميم: أبيض وأزرق — مجاني 100% — مرن وذكي للتعرف على جميع أنواع الأسئلة.</footer>
</div>
<script>
function trim(s){return s? s.trim():'';}
function parseInput(text){
 var lines=text.replace(/\r/g,'').split('\n');
 var questions=[]; var i=0;
 while(i<lines.length){
 var line=trim(lines[i]); if(!line){i++; continue;}
 var q={question:'',choices:[],type:'mcq',correctIndex:-1,points:0};
 q.question=line;
 i++;
 while(i<lines.length){
 var nxt=trim(lines[i]);
 if(!nxt){i++; continue;}
 if(/^[أابجدةA-Za-z]\./.test(nxt)){ q.choices.push(nxt.replace(/^[أابجدةA-Za-z]\./,'')); i++; continue;}
 if(/^(عرف|علل|أجب|عدد|ضع دائرة)/i.test(nxt) || (nxt.indexOf('.')===-1 && nxt.indexOf(' ')>0 && nxt.length>3 && q.choices.length===0)){break;}
 if(/^[0-9]+\./.test(nxt)){break;}
 i++;
 }
 if(q.choices.length===0){q.type='text';}
 questions.push(q);
 }
 return questions;
}
function generateAppsScript(questions, uniformPoints, immediateRelease){
 var arrLines=[];
 questions.forEach(function(q){
 var pts=(uniformPoints>0)? uniformPoints:1;
 if(q.type==='mcq'){
 var choices=q.choices.join(';');
 var correctIdx=(q.correctIndex>=0)?q.correctIndex:0;
 arrLines.push('"'+q.question.replace(/"/g,'\"')+' | '+choices+' | '+correctIdx+' | '+pts+'"');
 }else{
 arrLines.push('"'+q.question.replace(/"/g,'\"')+' | TEXT | | '+pts+'"');
 }
 });
 var arrBlock=arrLines.join(',\n    ');
 var releaseSetting=immediateRelease?'FormApp.QuizReleaseType.IMMEDIATE':'FormApp.QuizReleaseType.MANUAL';
 var script='function createQuizFromText(){\n  var rawQuestions=[\n    '+arrBlock+'\n  ];\n  var form=FormApp.create("Quiz from Script");\n  form.setIsQuiz(true);\n  try{ form.setReleaseGrades('+releaseSetting+');}catch(e){}\n  rawQuestions.forEach(function(line){\n    var parts=line.split("|").map(function(s){return s.trim();});\n    var questionText=parts[0]; var choicesText=parts[1]; var correctIndex=parseInt(parts[2],10); var points=parseFloat(parts[3])||0;\n    if(choicesText==="TEXT"){\n      form.addTextItem().setTitle(questionText);\n    }else{\n      var item=form.addMultipleChoiceItem();\n      item.setTitle(questionText);\n      var createdChoices=choicesText.split(';').map(function(c,i){return item.createChoice(c,i===correctIndex);});\n      item.setChoices(createdChoices);\n      try{item.setPoints(points);}catch(e){}\n    }\n  });\n  Logger.log("Created quiz (open edit URL): "+form.getEditUrl());\n}';
 return script;
}
var inputEl=document.getElementById('inputText');
var createBtn=document.getElementById('createBtn');
var resultEl=document.getElementById('result');
var copyBtn=document.getElementById('copyBtn');
var downloadLink=document.getElementById('downloadLink');
var clearBtn=document.getElementById('clearBtn');
clearBtn.addEventListener('click',function(){inputEl.value=''; resultEl.textContent='اضغط "إنشاء" لتوليد الكود هنا...'; downloadLink.removeAttribute('href'); downloadLink.textContent='تنزيل الملف';});
createBtn.addEventListener('click',function(){
 var text=inputEl.value; if(!trim(text)){alert('الرجاء لصق الأسئلة أولاً'); return;}
 var uniform=parseFloat(document.getElementById('uniformPoints').value)||0;
 var immediate=document.getElementById('showImmediately').value==='true';
 var questions=parseInput(text);
 var script=generateAppsScript(questions,uniform,immediate);
 resultEl.textContent=script;
 var blob=new Blob([script],{type:'text/javascript;charset=utf-8'});
 var url=URL.createObjectURL(blob);
 downloadLink.href=url; downloadLink.download='create_quiz_apps_script.js'; downloadLink.textContent='تنزيل ملف JS';
});
copyBtn.addEventListener('click',function(){var text=resultEl.textContent||''; if(!text){alert('لا يوجد نص لنسخه'); return;} navigator.clipboard.writeText(text).then(function(){alert('تم النسخ بنجاح!');}).catch(function(){alert('فشل النسخ، انسخ يدوياً.');});});
</script>
</body>
</html>
